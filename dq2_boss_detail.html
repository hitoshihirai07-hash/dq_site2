<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>DQII ボス詳細（HD-2D版）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  line-height: 1.6;
  max-width: 1100px;
  margin: 0 auto;
  padding: 16px;
  background-color: #f7f2e9; /* トップと同系統の薄いオレンジ系 */
  color: #333;
}
a {
  color: #1f5faa;
}
h1 {
  font-size: 1.6rem;
  margin-top: 0;
  margin-bottom: 0.5rem;
  border-bottom: 2px solid #d4b27c;
  padding-bottom: 0.25rem;
}
h2 {
  font-size: 1.2rem;
  margin-top: 1.6rem;
  margin-bottom: 0.4rem;
  border-left: 4px solid #d4b27c;
  padding-left: 0.5rem;
}
p.nav {
  margin-bottom: 12px;
  font-size: 0.9rem;
}
p.nav a {
  margin-right: 8px;
}
table {
  border-collapse: collapse;
  width: 100%;
  font-size: 0.9rem;
  margin-bottom: 12px;
}
th, td {
  border: 1px solid #ccc;
  padding: 4px 6px;
  text-align: left;
}
th {
  background-color: #f2e7d7;
}
tbody tr:nth-child(odd) {
  background-color: #fbf7f0;
}
tbody tr:nth-child(even) {
  background-color: #fdfaf5;
}
.status-empty {
  text-align: center;
  padding: 8px 0;
  color: #777;
}
.action-unit {
  margin-bottom: 12px;
  padding: 8px 10px;
  border: 1px solid #d4b27c;
  background-color: #fdfaf5;
}
.action-unit h3 {
  margin: 0 0 4px 0;
  font-size: 1rem;
}
.action-unit p {
  margin: 0;
  white-space: pre-wrap; /* 行動パターンを折り返して表示 */
  font-size: 0.9rem;
}
@media (max-width: 768px) {
  body {
    padding: 12px;
  }
  h1 {
    font-size: 1.3rem;
  }
}

  </style>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <p class="nav">
    <a href="./index.html">← トップに戻る</a>
    <a href="./dq2_boss_list.html">← DQII ボス一覧に戻る</a>
  </p>

  <h1>DQII ボス詳細</h1>
  <p id="boss-title"></p>

  <h2>ステータス</h2>
  <table id="status-table">
    <thead></thead>
    <tbody>
      <tr><td class="status-empty">読み込み中...</td></tr>
    </tbody>
  </table>

  <h2>行動パターン</h2>
  <div id="action-container">
    <p class="status-empty">読み込み中...</p>
  </div>

  <h2>耐性まとめ</h2>
  <p>◎…特に有効 ／ ○…有効 ／ △…やや効きにくい ／ ×…ほとんど効かない</p>
  <table id="res-table">
    <thead></thead>
    <tbody>
      <tr><td class="status-empty">読み込み中...</td></tr>
    </tbody>
  </table>

  <script>
    const CSV_MULTI = "dq2_boss_multiunit.csv";
    const CSV_RESIST = "dq2_boss_resistance.csv";

    function getBossNameFromQuery() {
      const params = new URLSearchParams(window.location.search);
      return params.get("boss") || "";
    }

    function setBossTitle(name) {
      const el = document.getElementById("boss-title");
      if (!name) {
        el.textContent = "ボス戦名が指定されていません。";
      } else {
        el.textContent = "ボス戦名：" + name;
      }
    }

    async function loadCsv(path) {
      const res = await fetch(path);
      if (!res.ok) throw new Error("データの読み込みに失敗しました: " + path);
      const text = await res.text();
      const parsed = Papa.parse(text, {
        header: true,
        skipEmptyLines: true,
      });
      return parsed.data;
    }

    function isEmptyValue(v) {
      if (v === null || v === undefined) return true;
      const s = String(v).trim();
      return s === "" || s.toLowerCase() === "nan";
    }

    function buildStatusTable(rows) {
      const thead = document.querySelector("#status-table thead");
      const tbody = document.querySelector("#status-table tbody");
      thead.innerHTML = "";
      tbody.innerHTML = "";

      if (!rows.length) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 99;
        td.className = "status-empty";
        td.textContent = "このボスのステータス情報は登録されていません。";
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      const allCols = Object.keys(rows[0]);
      const preferred = ["個体名", "体数", "HP", "攻撃力", "守備力", "経験値", "ゴールド", "出現場所"];
      const candidate = preferred.filter(c => allCols.includes(c));
      const visible = candidate.filter(col =>
        rows.some(r => !isEmptyValue(r[col]))
      );

      const trHead = document.createElement("tr");
      visible.forEach(col => {
        const th = document.createElement("th");
        th.textContent = col;
        trHead.appendChild(th);
      });
      thead.appendChild(trHead);

      rows.forEach(r => {
        const tr = document.createElement("tr");
        visible.forEach(col => {
          const td = document.createElement("td");
          const v = r[col];
          td.textContent = isEmptyValue(v) ? "" : v;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    function buildActionBlocks(rows) {
      const container = document.getElementById("action-container");
      container.innerHTML = "";

      if (!rows.length) {
        const p = document.createElement("p");
        p.className = "status-empty";
        p.textContent = "このボスの行動パターン情報は登録されていません。";
        container.appendChild(p);
        return;
      }

      const allCols = Object.keys(rows[0]);
      const statusCols = ["ボス戦名", "個体名", "体数", "HP", "攻撃力", "守備力", "経験値", "ゴールド", "出現場所"];
      const textCols = allCols.filter(c => !statusCols.includes(c));

      rows.forEach(r => {
        const unitDiv = document.createElement("div");
        unitDiv.className = "action-unit";

        const h = document.createElement("h3");
        h.textContent = (r["個体名"] || "").trim() || "個体";
        unitDiv.appendChild(h);

        let lines = [];
        textCols.forEach(col => {
          const v = r[col];
          if (!isEmptyValue(v)) {
            if (col === "特徴メモ") {
              lines.push("特徴：" + v);
            } else if (col === "行動パターン") {
              lines.push("行動パターン：" + v);
            } else {
              lines.push(col + "：" + v);
            }
          }
        });

        const p = document.createElement("p");
        p.textContent = lines.join("\n");
        unitDiv.appendChild(p);

        container.appendChild(unitDiv);
      });
    }

    function buildResTable(rows) {
      const thead = document.querySelector("#res-table thead");
      const tbody = document.querySelector("#res-table tbody");
      thead.innerHTML = "";
      tbody.innerHTML = "";

      if (!rows.length) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 99;
        td.className = "status-empty";
        td.textContent = "このボスの耐性データは登録されていません。";
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      const allCols = Object.keys(rows[0]);
      const candidate = allCols.filter(c => c !== "ボス戦名");
      const visible = candidate.filter(col =>
        rows.some(r => !isEmptyValue(r[col]))
      );

      const trHead = document.createElement("tr");
      visible.forEach(col => {
        const th = document.createElement("th");
        th.textContent = col;
        trHead.appendChild(th);
      });
      thead.appendChild(trHead);

      rows.forEach(r => {
        const tr = document.createElement("tr");
        visible.forEach(col => {
          const td = document.createElement("td");
          const v = r[col];
          td.textContent = isEmptyValue(v) ? "" : v;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    async function init() {
      const bossName = getBossNameFromQuery();
      setBossTitle(bossName);

      if (!bossName) {
        buildStatusTable([]);
        buildActionBlocks([]);
        buildResTable([]);
        return;
      }

      try {
        const multiRows = await loadCsv(CSV_MULTI);
        const targetMulti = multiRows.filter(r => (r["ボス戦名"] || "").trim() === bossName.trim());
        buildStatusTable(targetMulti);
        buildActionBlocks(targetMulti);
      } catch (e) {
        console.error(e);
        buildStatusTable([]);
        buildActionBlocks([]);
      }

      try {
        const resRows = await loadCsv(CSV_RESIST);
        const targetRes = resRows.filter(r => (r["ボス戦名"] || "").trim() === bossName.trim());
        buildResTable(targetRes);
      } catch (e) {
        console.error(e);
        buildResTable([]);
      }
    }

    init();
  </script>
</body>
</html>
