<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>DQ2 ボス耐性一覧（HD-2D版）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  line-height: 1.6;
  max-width: 1200px;
  margin: 0 auto;
  padding: 16px;
  background: #111;
  color: #f5f5f5;
}
a {
  color: #7fd1ff;
}
h1 {
  font-size: 1.6rem;
  margin-bottom: 0.5rem;
  border-bottom: 1px solid #444;
  padding-bottom: 0.3rem;
}
h2 {
  font-size: 1.2rem;
  margin-top: 1.8rem;
  border-left: 4px solid #7fd1ff;
  padding-left: 0.5rem;
}
.nav-links {
  margin-bottom: 12px;
  font-size: 0.9rem;
}
.nav-links a {
  margin-right: 8px;
}
.description {
  font-size: 0.9rem;
  color: #ddd;
  margin-bottom: 8px;
}
.legend {
  font-size: 0.85rem;
  color: #ccc;
  margin: 4px 0 12px;
}
.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin: 8px 0 12px;
  font-size: 0.9rem;
}
.controls label {
  display: flex;
  align-items: center;
  gap: 4px;
}
.controls select,
.controls input[type="search"] {
  background: #181818;
  border: 1px solid #444;
  border-radius: 4px;
  padding: 4px 6px;
  color: #f5f5f5;
  font-size: 0.9rem;
}
.table-wrapper {
  overflow-x: auto;
  border: 1px solid #333;
  border-radius: 4px;
}
table {
  border-collapse: collapse;
  min-width: 600px;
  width: 100%;
  font-size: 0.85rem;
}
th, td {
  border: 1px solid #333;
  padding: 4px 6px;
  text-align: center;
  white-space: nowrap;
}
th {
  background: #222;
  position: sticky;
  top: 0;
  z-index: 1;
}
tbody tr:nth-child(odd) {
  background: #181818;
}
tbody tr:nth-child(even) {
  background: #151515;
}
.name-col {
  text-align: left;
}
.status-empty {
  text-align: center;
  padding: 12px 0;
  color: #aaa;
}
@media (max-width: 768px) {
  body {
    padding: 12px;
  }
  h1 {
    font-size: 1.3rem;
  }
  .controls {
    flex-direction: column;
    align-items: flex-start;
  }
}

  </style>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <div class="nav-links">
    <a href="./index.html">← トップに戻る</a>
    <a href="./dq2_boss_list.html">← DQ2 ボス一覧に戻る</a>
    <a href="./dq1_boss_resistance.html">→ DQ1 ボス耐性へ</a>
  </div>

  <header>
    <h1>DQ2 ボス耐性一覧（HD-2D版）</h1>
    <p class="description">
      各ボスについて、攻撃呪文・補助・状態異常などの効きやすさを一覧にまとめています。
    </p>
    <p class="legend">
      ◎…特に有効　／　○…有効　／　△…やや効きにくい　／　×…ほとんど効かない
    </p>
  </header>

  <main>
    <section>
      <h2>耐性一覧</h2>
      <div class="controls">
        <label>
          ボス戦名で絞り込み：
          <select id="boss-filter">
            <option value="">すべて表示</option>
          </select>
        </label>
        <label>
          名前検索：
          <input type="search" id="name-filter" placeholder="ボス名・個体名の一部を入力">
        </label>
      </div>

      <div class="table-wrapper">
        <table id="res-table">
          <thead></thead>
          <tbody>
            <tr><td class="status-empty">読み込み中...</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    const CSV_PATH = "dq2_boss_resistance.csv";
    let allRows = [];

    function createTableHeader(headers) {
      const thead = document.querySelector("#res-table thead");
      thead.innerHTML = "";
      const tr = document.createElement("tr");
      headers.forEach((h, idx) => {
        const th = document.createElement("th");
        th.textContent = h;
        if (h === "ボス戦名" || h === "個体名") {
          th.classList.add("name-col");
        }
        tr.appendChild(th);
      });
      thead.appendChild(tr);
    }

    function renderRows(rows) {
      const tbody = document.querySelector("#res-table tbody");
      tbody.innerHTML = "";
      if (!rows.length) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 99;
        td.className = "status-empty";
        td.textContent = "条件に合うボスが見つかりませんでした。";
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      const headers = Object.keys(rows[0]);
      rows.forEach(row => {
        const tr = document.createElement("tr");
        headers.forEach((h, idx) => {
          const td = document.createElement("td");
          if (h === "ボス戦名" || h === "個体名") {
            td.classList.add("name-col");
          }
          const value = row[h] ?? "";
          td.textContent = value;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    function fillFilters(rows) {
      const bossSelect = document.getElementById("boss-filter");
      const bossNames = Array.from(new Set(rows.map(r => r["ボス戦名"]).filter(Boolean)));
      bossNames.sort((a, b) => a.localeCompare(b, "ja"));
      bossNames.forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        bossSelect.appendChild(opt);
      });
    }

    function applyFilters() {
      const bossValue = document.getElementById("boss-filter").value;
      const textValue = document.getElementById("name-filter").value.trim();

      let filtered = allRows.slice();
      if (bossValue) {
        filtered = filtered.filter(r => r["ボス戦名"] === bossValue);
      }
      if (textValue) {
        filtered = filtered.filter(r => {
          const b = r["ボス戦名"] || "";
          const k = r["個体名"] || "";
          return b.includes(textValue) || k.includes(textValue);
        });
      }
      renderRows(filtered);
    }

    async function loadData() {
      try {
        const res = await fetch(CSV_PATH);
        if (!res.ok) throw new Error("データの読み込みに失敗しました");
        const text = await res.text();
        const parsed = Papa.parse(text, {
          header: true,
          skipEmptyLines: true,
        });
        const rows = parsed.data;
        if (!rows.length) throw new Error("データが空です");

        allRows = rows;
        createTableHeader(Object.keys(rows[0]));
        fillFilters(rows);
        applyFilters();
      } catch (e) {
        console.error(e);
        const tbody = document.querySelector("#res-table tbody");
        tbody.innerHTML = "";
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 99;
        td.className = "status-empty";
        td.textContent = "データの読み込みに失敗しました。時間をおいて再度アクセスしてください。";
        tr.appendChild(td);
        tbody.appendChild(tr);
      }
    }

    document.getElementById("boss-filter").addEventListener("change", applyFilters);
    document.getElementById("name-filter").addEventListener("input", applyFilters);

    loadData();
  </script>
</body>
</html>
