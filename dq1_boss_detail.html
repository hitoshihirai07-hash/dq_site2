<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>DQI ボス詳細（HD-2D版）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  line-height: 1.6;
  max-width: 1100px;
  margin: 0 auto;
  padding: 16px;
  background-color: #f7f2e9; /* ややオレンジがかった薄いグレー */
  color: #333;
}
a {
  color: #1f5faa;
}
header h1, h1 {
  font-size: 1.6rem;
  margin-top: 0;
  margin-bottom: 0.5rem;
  border-bottom: 2px solid #d4b27c;
  padding-bottom: 0.25rem;
}
h2 {
  font-size: 1.2rem;
  margin-top: 1.6rem;
  margin-bottom: 0.4rem;
  border-left: 4px solid #d4b27c;
  padding-left: 0.5rem;
}
nav, .nav-links {
  margin-bottom: 12px;
  font-size: 0.9rem;
}
nav a, .nav-links a {
  margin-right: 8px;
}
p.note, .legend {
  font-size: 0.85rem;
  color: #555;
}
table {
  border-collapse: collapse;
  width: 100%;
  font-size: 0.9rem;
}
th, td {
  border: 1px solid #ccc;
  padding: 4px 6px;
  text-align: left;
  white-space: nowrap;
}
th {
  background-color: #f2e7d7;
}
tbody tr:nth-child(odd) {
  background-color: #fbf7f0;
}
tbody tr:nth-child(even) {
  background-color: #fdfaf5;
}
.name-col {
  text-align: left;
}
.status-empty {
  text-align: center;
  padding: 12px 0;
  color: #777;
}
@media (max-width: 768px) {
  body {
    padding: 12px;
  }
  header h1, h1 {
    font-size: 1.3rem;
  }
}

  .section-box {
    margin-bottom: 16px;
  }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <div class="nav-links">
    <a href="./index.html">← トップに戻る</a>
    <a href="./dq1_boss_list.html">← DQI ボス一覧に戻る</a>
  </div>

  <header>
    <h1>DQI ボス詳細</h1>
    <p id="boss-title"></p>
  </header>

  <main>
    <section id="basic-info" class="section-box">
      <h2>基本情報</h2>
      <p class="note">
        HPや攻撃パターン、経験値・ゴールドなどの詳細は順次追記していきます。
      </p>
    </section>

    <section id="resistance-section" class="section-box">
      <h2>耐性まとめ</h2>
      <p class="legend">
        ◎…特に有効　／　○…有効　／　△…やや効きにくい　／　×…ほとんど効かない
      </p>
      <table id="res-table">
        <thead></thead>
        <tbody>
          <tr><td class="status-empty">読み込み中...</td></tr>
        </tbody>
      </table>
    </section>
  </main>

  <script>
    const CSV_PATH = "dq1_boss_resistance.csv";

    function getBossNameFromQuery() {
      const params = new URLSearchParams(window.location.search);
      return params.get("boss") || "";
    }

    function setBossTitle(name) {
      const el = document.getElementById("boss-title");
      if (!name) {
        el.textContent = "ボス戦名が指定されていません。";
      } else {
        el.textContent = "ボス戦名：" + name;
      }
    }

    function createTableHeader(headers) {
      const thead = document.querySelector("#res-table thead");
      thead.innerHTML = "";
      const tr = document.createElement("tr");
      headers.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        if (h === "個体名") th.classList.add("name-col");
        tr.appendChild(th);
      });
      thead.appendChild(tr);
    }

    function renderRows(rows, headers) {
      const tbody = document.querySelector("#res-table tbody");
      tbody.innerHTML = "";
      if (!rows.length) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 99;
        td.className = "status-empty";
        td.textContent = "このボスの耐性データは登録されていません。";
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }
      rows.forEach(row => {
        const tr = document.createElement("tr");
        headers.forEach(h => {
          const td = document.createElement("td");
          if (h === "個体名") td.classList.add("name-col");
          td.textContent = row[h] ?? "";
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
    }

    async function loadResistance(bossName) {
      const tbody = document.querySelector("#res-table tbody");
      if (!bossName) {
        tbody.innerHTML = "";
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 99;
        td.className = "status-empty";
        td.textContent = "ボス戦名が指定されていません。";
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }
      try {
        const res = await fetch(CSV_PATH);
        if (!res.ok) throw new Error("データの読み込みに失敗しました");
        const text = await res.text();
        const parsed = Papa.parse(text, {
          header: true,
          skipEmptyLines: true,
        });
        let rows = parsed.data.filter(r => (r["ボス戦名"] || "").trim() === bossName.trim());
        if (!rows.length) {
          tbody.innerHTML = "";
          const tr = document.createElement("tr");
          const td = document.createElement("td");
          td.colSpan = 99;
          td.className = "status-empty";
          td.textContent = "指定されたボス戦名に対応する耐性データが見つかりませんでした。";
          tr.appendChild(td);
          tbody.appendChild(tr);
          return;
        }
        const allHeaders = Object.keys(rows[0]);
        const headers = allHeaders.filter(h => h !== "ボス戦名");
        createTableHeader(headers);
        renderRows(rows, headers);
      } catch (e) {
        console.error(e);
        tbody.innerHTML = "";
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 99;
        td.className = "status-empty";
        td.textContent = "耐性データの読み込みに失敗しました。時間をおいて再度アクセスしてください。";
        tr.appendChild(td);
        tbody.appendChild(tr);
      }
    }

    (function init() {
      const bossName = getBossNameFromQuery();
      setBossTitle(bossName);
      loadResistance(bossName);
    })();
  </script>
</body>
</html>
