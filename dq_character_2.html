<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>DQ2ローレシア王子 | ドラゴンクエストI・II HD-2D 非公式メモ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  line-height: 1.6;
  max-width: 1100px;
  margin: 0 auto;
  padding: 16px;
  background-color: #f7f2e9; /* トップページと同系統の薄いオレンジ系 */
  color: #333;
}
a {
  color: #1f5faa;
}
header h1, h1 {
  font-size: 1.6rem;
  margin-top: 0;
  margin-bottom: 0.5rem;
  border-bottom: 2px solid #d4b27c;
  padding-bottom: 0.25rem;
}
h2 {
  font-size: 1.2rem;
  margin-top: 1.6rem;
  margin-bottom: 0.4rem;
  border-left: 4px solid #d4b27c;
  padding-left: 0.5rem;
}
nav {
  margin-bottom: 12px;
  font-size: 0.9rem;
}
nav a {
  margin-right: 8px;
}
p.note, .legend {
  font-size: 0.85rem;
  color: #555;
}
table {
  border-collapse: collapse;
  width: 100%;
  font-size: 0.9rem;
  margin-bottom: 12px;
}
th, td {
  border: 1px solid #ccc;
  padding: 4px 6px;
  text-align: left;
  white-space: nowrap;
}
th {
  background-color: #f2e7d7;
}
tbody tr:nth-child(odd) {
  background-color: #fbf7f0;
}
tbody tr:nth-child(even) {
  background-color: #fdfaf5;
}
.status-empty {
  text-align: center;
  padding: 8px 0;
  color: #777;
}
@media (max-width: 768px) {
  body {
    padding: 12px;
  }
  header h1, h1 {
    font-size: 1.3rem;
  }
}

      .table-flex {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .table-block {
      flex: 1 1 260px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <nav>
    <a href="./index.html">← トップページに戻る</a>
    <a href="./dq_character.html">← キャラクター情報に戻る</a>
  </nav>

  <header>
    <h1>DQ2ローレシア王子</h1>
  </header>

  <main>
    <section id="initial-stats-section">
      <h2>初期ステータス（HD-2D版）</h2>
      <p class="note">
        ゲーム内の検証結果をもとにした初期レベルと能力値の一覧です。<br>
        HP・MPは表には含めていませんが、目安として「HPはたいりょくの2倍」「MPはかしこさの2倍」と考えてください。
      </p>
      <table id="initial-stats-table">
        <thead>
          <tr>
            <th>キャラ名</th>
            <th>初期Lv</th>
            <th>ちから</th>
            <th>みのまもり</th>
            <th>すばやさ</th>
            <th>たいりょく</th>
            <th>かしこさ</th>
            <th>うんのよさ</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="8" class="status-empty">読み込み中...</td></tr>
        </tbody>
      </table>
    </section>

    <section id="exp-table-section">
      <h2>レベル別経験値</h2>
      <p class="note">
        経験値テーブルとあわせて、各レベルごとの運基準（運基準／運下限／運上限）も掲載しています。<br>
        ・運下限以下：0.8～0.9倍ダメージ<br>
        ・下限超～上限未満：0.9～1.1倍ダメージ<br>
        ・運上限以上：1.1～1.2倍ダメージ
      </p>
      <table id="exp-table">
        <thead>
          <tr>
            <th>Lv</th>
            <th>累計</th>
            <th>運基準</th>
            <th>運下限</th>
            <th>運上限</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="5" class="status-empty">読み込み中...</td></tr>
        </tbody>
      </table>
    </section>

    <section id="skills-section">
      <h2>習得呪文・特技</h2>
      <table>
        <thead>
          <tr>
            <th>Lv</th>
            <th>内容</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>1</td><td>しっぷう突き、けもの突き、とびひざげり</td></tr>
          <tr><td>2</td><td>石つぶて</td></tr>
          <tr><td>7</td><td>ちからため</td></tr>
          <tr><td>9</td><td>かぶと割り</td></tr>
          <tr><td>13</td><td>必中拳</td></tr>
          <tr><td>16</td><td>もろば斬り</td></tr>
          <tr><td>18</td><td>ドラゴン斬り</td></tr>
          <tr><td>22</td><td>まじん斬り</td></tr>
          <tr><td>24</td><td>やいばくだき</td></tr>
          <tr><td>26</td><td>せいけん突き</td></tr>
          <tr><td>28</td><td>におうだち</td></tr>
          <tr><td>30</td><td>すてみ</td></tr>
          <tr><td>31</td><td>おうえん</td></tr>
          <tr><td>34</td><td>めいそう</td></tr>
          <tr><td>36</td><td>ばくれつけん</td></tr>
          <tr><td>38</td><td>ぶんまわし</td></tr>
          <tr><td>41</td><td>渾身斬り</td></tr>
        </tbody>
      </table>
    </section>
  </main>

  <script>
    const CHARACTER_CONFIG = {
      initialName: "DQ2ローレシア王子",
      expTotalColumn: "DQ2ローレシア王子",
      abilityKey: "DQ2ローレ"
    };

    async function loadCsv(path) {
      const res = await fetch(path);
      if (!res.ok) throw new Error("読み込み失敗: " + path);
      const text = await res.text();
      const parsed = Papa.parse(text, {
        header: true,
        skipEmptyLines: true,
      });
      return parsed.data;
    }

    function isEmptyValue(v) {
      if (v === null || v === undefined) return true;
      const s = String(v).trim();
      if (s === "" || s.toLowerCase() === "nan") return true;
      return false;
    }

    function fillInitialStats(rows) {
      const tbody = document.querySelector("#initial-stats-table tbody");
      tbody.innerHTML = "";
      const row = rows.find(r => (r["キャラ名"] || "").trim() === CHARACTER_CONFIG.initialName);
      if (!row) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 8;
        td.className = "status-empty";
        td.textContent = "該当キャラクターのデータが見つかりませんでした。";
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }
      const tr = document.createElement("tr");
      function cell(key) {
        const td = document.createElement("td");
        td.textContent = row[key] ?? "";
        return td;
      }
      tr.appendChild(cell("キャラ名"));
      tr.appendChild(cell("初期レベル"));
      tr.appendChild(cell("ちから"));
      tr.appendChild(cell("みのまもり"));
      tr.appendChild(cell("すばやさ"));
      tr.appendChild(cell("たいりょく"));
      tr.appendChild(cell("かしこさ"));
      tr.appendChild(cell("うんのよさ"));
      tbody.appendChild(tr);
    }

    function fillExpTable(expRows, abilityRows) {
  const tbody = document.querySelector("#exp-table tbody");
  tbody.innerHTML = "";

  // 対象キャラの運基準データをレベル別にまとめる
  const luckRows = (abilityRows || []).filter(r => (r["キャラ名"] || "").trim() === CHARACTER_CONFIG.abilityKey);
  const luckByLevel = {};
  luckRows.forEach(r => {
    const lv = String(r["レベル"] || "").trim();
    if (!lv) return;
    luckByLevel[lv] = r;
  });

  // 加入レベル（最初に累計が入る行）を特定
  let joinLevel = null;
  expRows.forEach(r => {
    const total = r[CHARACTER_CONFIG.expTotalColumn];
    const level = r["レベル"];
    if (!isEmptyValue(total) && joinLevel === null && level !== undefined && level !== "") {
      joinLevel = level;
    }
  });
  // DQ2ローレ（主人公）の場合は、加入レベルを1として扱う（Lv1は経験値が空欄でも表示したい）
  if (CHARACTER_CONFIG.abilityKey === "DQ2ローレ") {
    joinLevel = 1;
  }


  // 経験値データをレベル別にまとめる
  const expByLevel = {};
  expRows.forEach(r => {
    const lv = String(r["レベル"] || "").trim();
    if (!lv) return;
    expByLevel[lv] = r;
  });

  // 経験値・運の両方に存在するレベル + どちらか片方だけに存在するレベルをすべて対象にする
  const levelSet = new Set();
  expRows.forEach(r => {
    const lv = String(r["レベル"] || "").trim();
    if (!lv) return;
    levelSet.add(lv);
  });
  luckRows.forEach(r => {
    const lv = String(r["レベル"] || "").trim();
    if (!lv) return;
    levelSet.add(lv);
  });

  const sortedLevels = Array.from(levelSet).sort((a, b) => Number(a) - Number(b));

  sortedLevels.forEach(level => {
    // 加入前はスキップ
    if (joinLevel !== null && Number(level) < Number(joinLevel)) return;

    const expRow = expByLevel[level] || {};
    const total = expRow[CHARACTER_CONFIG.expTotalColumn];

    const tr = document.createElement("tr");

    // Lv
    const tdLv = document.createElement("td");
    tdLv.textContent = level;
    tr.appendChild(tdLv);

    // 累計
    const tdTotal = document.createElement("td");
    tdTotal.textContent = isEmptyValue(total) ? "" : total;
    tr.appendChild(tdTotal);

    // 運系（なければ空欄）
    const luck = luckByLevel[String(level).trim()] || {};
    const tdLuckBase = document.createElement("td");
    tdLuckBase.textContent = luck["運基準"] ?? "";
    tr.appendChild(tdLuckBase);

    const tdLuckMin = document.createElement("td");
    tdLuckMin.textContent = luck["運下限"] ?? "";
    tr.appendChild(tdLuckMin);

    const tdLuckMax = document.createElement("td");
    tdLuckMax.textContent = luck["運上限"] ?? "";
    tr.appendChild(tdLuckMax);

    tbody.appendChild(tr);
  });

  if (!tbody.hasChildNodes()) {
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = 5;
    td.className = "status-empty";
    td.textContent = "経験値データが見つかりませんでした。";
    tr.appendChild(td);
    tbody.appendChild(tr);
  }
}

    function fillLuckTable(rows) {
      const tbody = document.querySelector("#luck-table tbody");
      if (!tbody) return;
      tbody.innerHTML = "";

      const filtered = rows.filter(r => (r["キャラ名"] || "").trim() === CHARACTER_CONFIG.abilityKey);
      if (filtered.length === 0) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 4;
        td.className = "status-empty";
        td.textContent = "運基準データが見つかりませんでした。";
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      filtered.sort((a, b) => {
        const la = Number(a["レベル"] || 0);
        const lb = Number(b["レベル"] || 0);
        return la - lb;
      });

      filtered.forEach(r => {
        const tr = document.createElement("tr");
        function append(key) {
          const td = document.createElement("td");
          td.textContent = r[key] ?? "";
          tr.appendChild(td);
        }
        append("レベル");
        append("運基準");
        append("運下限");
        append("運上限");
        tbody.appendChild(tr);
      });
    }

    (async function init() {
      try {
        const [initialRows, expRows, abilityRows] = await Promise.all([
          loadCsv("dq_Initial%20value.csv"),
          loadCsv("dq2_experience%20value%20table.csv"),
          loadCsv("dq_data_ability.csv"),
        ]);
        fillInitialStats(initialRows);
        fillExpTable(expRows, abilityRows);
      } catch (e) {
        console.error(e);
        const tbody1 = document.querySelector("#initial-stats-table tbody");
        const tbody2 = document.querySelector("#exp-table tbody");
        if (tbody1) {
          tbody1.innerHTML = "<tr><td colspan='8' class='status-empty'>データの読み込みに失敗しました。</td></tr>";
        }
        if (tbody2) {
          tbody2.innerHTML = "<tr><td colspan='5' class='status-empty'>データの読み込みに失敗しました。</td></tr>";
        }
      }
    })();
  </script>
</body>
</html>
