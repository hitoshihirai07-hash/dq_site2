<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DQ!主人公 | ドラゴンクエストI・II HD-2D 非公式メモ</title>
  <link rel="stylesheet" href="theme.css" />
  <style>
    .character-block {
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 0.75rem 1rem;
      margin: 1.5rem 0;
    }
    .character-block h1 {
      margin-top: 0;
    }
    table.data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.5rem;
    }
    table.data-table th,
    table.data-table td {
      border: 1px solid #ccc;
      padding: 0.25rem 0.5rem;
    }
    table.data-table th {
      background: #f5f5f5;
      text-align: left;
    }
    p.note {
      font-size: 0.85rem;
      color: #555;
    }
    .status-empty {
      text-align: center;
      padding: 0.5rem 0;
      color: #777;
    }
      .table-flex {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .table-block {
      flex: 1 1 260px;
    }
  </style>
</head>
<body>
  <main class="page-main">
    <p><a href="index.html">&larr; トップページに戻る</a></p>

    <section class="character-block">
      <h1>DQ1主人公</h1>
      <h2>初期ステータス（HD-2D版）</h2>
      <p class="note">
        ゲーム内の検証結果をもとにした初期レベルと能力値の一覧です。<br>
        HP・MPは表には含めていませんが、目安として「HPはたいりょくの2倍」「MPはかしこさの2倍」と考えてください。
      </p>
      <table id="initial-stats-table" class="data-table">
        <thead>
          <tr>
            <th>キャラ名</th>
            <th>初期Lv</th>
            <th>ちから</th>
            <th>みのまもり</th>
            <th>すばやさ</th>
            <th>たいりょく</th>
            <th>かしこさ</th>
            <th>うんのよさ</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="8" class="status-empty">読み込み中...</td></tr>
        </tbody>
      </table>

      <h2>レベル別経験値</h2>
      <div class="table-flex">
        <div class="table-block">
          <table id="dq1-exp-table" class="data-table">
            <thead>
              <tr><th>Lv</th><th>累計</th></tr>
            </thead>
            <tbody>
              <tr><td colspan="2" class="status-empty">読み込み中...</td></tr>
            </tbody>
          </table>
        </div>
        <div class="table-block">
          <h3>レベル別運基準</h3>
          <table id="luck-table" class="data-table">
            <thead>
              <tr>
                <th>Lv</th>
                <th>運基準</th>
                <th>運下限</th>
                <th>運上限</th>
              </tr>
            </thead>
            <tbody>
              <tr><td colspan="4" class="status-empty">読み込み中...</td></tr>
            </tbody>
          </table>
          <p class="note">
            運基準とダメージ倍率の関係は次の通りです。<br>
            ・運下限以下：0.8～0.9倍ダメージ<br>
            ・下限超～上限未満：0.9～1.1倍ダメージ<br>
            ・運上限以上：1.1～1.2倍ダメージ
          </p>
        </div>
      </div>

      <h2>習得呪文・特技</h2>
      <table class="data-table">
        <thead>
          <tr><th>Lv</th><th>呪文</th><th>特技</th></tr>
        </thead>
        <tbody>
              <tr><td>1</td><td></td><td>けもの突き、うけながし</td></tr>
              <tr><td>3</td><td>ホイミ</td><td></td></tr>
              <tr><td>4</td><td>ギラ</td><td></td></tr>
              <tr><td>6</td><td>ラリホー</td><td>かえんぎり</td></tr>
              <tr><td>8</td><td>デイン、インパス</td><td></td></tr>
              <tr><td>10</td><td>マホトーン</td><td>みかわしきゃく</td></tr>
              <tr><td>12</td><td>リレミト</td><td>ドラゴン斬り</td></tr>
              <tr><td>13</td><td>ルーラ</td><td></td></tr>
              <tr><td>14</td><td>ベギラマ</td><td></td></tr>
              <tr><td>15</td><td>トヘロス</td><td></td></tr>
              <tr><td>16</td><td></td><td>大ぼうぎょ</td></tr>
              <tr><td>17</td><td>ベホイミ</td><td></td></tr>
              <tr><td>18</td><td></td><td>しんくう斬り</td></tr>
              <tr><td>21</td><td>ライデイン</td><td></td></tr>
              <tr><td>24</td><td></td><td>いなずま斬り</td></tr>
              <tr><td>27</td><td></td><td>はやぶさ斬り</td></tr>
              <tr><td>30</td><td>ベギラゴン</td><td></td></tr>
              <tr><td>32</td><td>フバーハ</td><td></td></tr>
              <tr><td>35</td><td>ギガデイン</td><td></td></tr>
              <tr><td>40</td><td>ギガスラッシュ</td><td></td></tr>
        </tbody>
      </table>
    </section>
    <p><a href="dq_character.html">&larr; キャラクター情報に戻る</a></p>
    <p><a href="index.html">&larr; トップページに戻る</a></p>
  </main>
  <script src="./dq1_experience.js"></script>
  <script>
    (function() {
      const ABILITY_KEY = "DQ1主人公";

      function parseCsv(text) {
        const lines = text.trim().split(/\r?\n/);
        if (lines.length <= 1) return [];
        const headers = lines[0].split(",");
        return lines.slice(1).map(function(line) {
          const cols = line.split(",");
          const obj = {};
          headers.forEach(function(h, idx) {
            obj[h] = (cols[idx] || "").trim();
          });
          return obj;
        });
      }

      function fillLuckTable(rows) {
        const tbody = document.querySelector("#luck-table tbody");
        if (!tbody) return;
        tbody.innerHTML = "";

        const filtered = rows.filter(function(r) {
          return (r["キャラ名"] || "").trim() === ABILITY_KEY;
        });

        if (filtered.length === 0) {
          const tr = document.createElement("tr");
          const td = document.createElement("td");
          td.colSpan = 4;
          td.className = "status-empty";
          td.textContent = "運基準データが見つかりませんでした。";
          tr.appendChild(td);
          tbody.appendChild(tr);
          return;
        }

        filtered.sort(function(a, b) {
          const la = Number(a["レベル"] || 0);
          const lb = Number(b["レベル"] || 0);
          return la - lb;
        });

        filtered.forEach(function(r) {
          const tr = document.createElement("tr");
          function append(key) {
            const td = document.createElement("td");
            td.textContent = r[key] ?? "";
            tr.appendChild(td);
          }
          append("レベル");
          append("運基準");
          append("運下限");
          append("運上限");
          tbody.appendChild(tr);
        });
      }

      fetch("dq_data_ability.csv")
        .then(function(res) {
          if (!res.ok) throw new Error("dq_data_ability.csv 読み込み失敗");
          return res.text();
        })
        .then(function(text) {
          const rows = parseCsv(text);
          fillLuckTable(rows);
        })
        .catch(function(e) {
          console.error(e);
          const tbody = document.querySelector("#luck-table tbody");
          if (tbody) {
            tbody.innerHTML = "<tr><td colspan='4' class='status-empty'>運基準データの読み込みに失敗しました。</td></tr>";
          }
        });
    })();
  </script>
</body>
</html>
