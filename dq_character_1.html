<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DQ!主人公 | ドラゴンクエストI・II HD-2D 非公式メモ</title>
  <link rel="stylesheet" href="theme.css" />
  <style>
    .character-block {
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 0.75rem 1rem;
      margin: 1.5rem 0;
    }
    .character-block h1 {
      margin-top: 0;
    }
    table.data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.5rem;
    }
    table.data-table th,
    table.data-table td {
      border: 1px solid #ccc;
      padding: 0.25rem 0.5rem;
    }
    table.data-table th {
      background: #f5f5f5;
      text-align: left;
    }
    p.note {
      font-size: 0.85rem;
      color: #555;
    }
    .status-empty {
      text-align: center;
      padding: 0.5rem 0;
      color: #777;
    }
  </style>
</head>
<body>
  <main class="page-main">
    <p><a href="index.html">&larr; トップページに戻る</a></p>

    <section class="character-block">
      <h1>DQ1主人公</h1>
      <h2>初期ステータス（HD-2D版）</h2>
      <p class="note">
        ゲーム内の検証結果をもとにした初期レベルと能力値の一覧です。<br>
        HP・MPは表には含めていませんが、目安として「HPはたいりょくの2倍」「MPはかしこさの2倍」と考えてください。
      </p>
      <table id="initial-stats-table" class="data-table">
        <thead>
          <tr>
            <th>キャラ名</th>
            <th>初期Lv</th>
            <th>ちから</th>
            <th>みのまもり</th>
            <th>すばやさ</th>
            <th>たいりょく</th>
            <th>かしこさ</th>
            <th>うんのよさ</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan="8" class="status-empty">読み込み中...</td></tr>
        </tbody>
      </table>

  <h2>レベル別経験値</h2>
<table id="dq1-exp-table" class="data-table">
  <thead>
    <tr><th>Lv</th><th>累計</th><th>運基準</th></tr>
  </thead>
  <tbody>
    <tr><td colspan="3" class="status-empty">読み込み中...</td></tr>
  </tbody>
</table>

<p class="note">
  【運基準について】<br>
  運下限以下：0.8～0.9倍ダメージ<br>
  下限超～上限未満：0.9～1.1倍ダメージ<br>
  運上限以上：1.1～1.2倍ダメージ
</p>


      <h2>習得呪文・特技</h2>
      <table class="data-table">
        <thead>
          <tr><th>Lv</th><th>呪文</th><th>特技</th></tr>
        </thead>
        <tbody>
              <tr><td>1</td><td></td><td>けもの突き、うけながし</td></tr>
              <tr><td>3</td><td>ホイミ</td><td></td></tr>
              <tr><td>4</td><td>ギラ</td><td></td></tr>
              <tr><td>6</td><td>ラリホー</td><td>かえんぎり</td></tr>
              <tr><td>8</td><td>デイン、インパス</td><td></td></tr>
              <tr><td>10</td><td>マホトーン</td><td>みかわしきゃく</td></tr>
              <tr><td>12</td><td>リレミト</td><td>ドラゴン斬り</td></tr>
              <tr><td>13</td><td>ルーラ</td><td></td></tr>
              <tr><td>14</td><td>ベギラマ</td><td></td></tr>
              <tr><td>15</td><td>トヘロス</td><td></td></tr>
              <tr><td>16</td><td></td><td>大ぼうぎょ</td></tr>
              <tr><td>17</td><td>ベホイミ</td><td></td></tr>
              <tr><td>18</td><td></td><td>しんくう斬り</td></tr>
              <tr><td>21</td><td>ライデイン</td><td></td></tr>
              <tr><td>24</td><td></td><td>いなずま斬り</td></tr>
              <tr><td>27</td><td></td><td>はやぶさ斬り</td></tr>
              <tr><td>30</td><td>ベギラゴン</td><td></td></tr>
              <tr><td>32</td><td>フバーハ</td><td></td></tr>
              <tr><td>35</td><td>ギガデイン</td><td></td></tr>
              <tr><td>40</td><td>ギガスラッシュ</td><td></td></tr>
        </tbody>
      </table>
    </section>
    <p><a href="dq_character.html">&larr; キャラクター情報に戻る</a></p>
    <p><a href="index.html">&larr; トップページに戻る</a></p>
  </main>
   <script src="./dq1_experience.js"></script>
  <script>
    // レベル別経験値に「運基準」を差し込む処理
    window.addEventListener("load", function () {
      const expTable = document.getElementById("dq1-exp-table");
      if (!expTable) return;

      // キャラ名（h1の文字）をそのままキーに使う
      const titleEl = document.querySelector(".character-block h1");
      const charName = titleEl ? titleEl.textContent.trim() : "";
      if (!charName) return;

      fetch("dq_data_ability.csv")
        .then(res => res.text())
        .then(text => {
          const lines = text.trim().split(/\r?\n/);
          if (lines.length < 2) return;

          const header = lines[0].split(",");

          const idx = name => header.indexOf(name);
          const idxName = idx("キャラ名");
          const idxLv   = idx("Lv");
          const idxLuck = idx("運基準");
          const idxMin  = idx("運下限");
          const idxMax  = idx("運上限");

          if (idxName < 0 || idxLv < 0) {
            console.warn("dq_data_ability.csv のヘッダーが想定と違います");
            return;
          }

          // Lvごとの運基準情報をキャラごとにまとめる
          const luckMap = {};
          for (let i = 1; i < lines.length; i++) {
            const line = lines[i].trim();
            if (!line) continue;
            const cols = line.split(",");

            const name = (cols[idxName] || "").trim();
            const lv   = (cols[idxLv]   || "").trim();
            if (!name || !lv) continue;
            if (name !== charName) continue; // このページのキャラだけ

            const luck = idxLuck >= 0 ? (cols[idxLuck] || "").trim() : "";
            const min  = idxMin  >= 0 ? (cols[idxMin]  || "").trim() : "";
            const max  = idxMax  >= 0 ? (cols[idxMax]  || "").trim() : "";

            const parts = [];
            if (luck) parts.push(luck);

            let range = "";
            if (min && max)       range = min + "～" + max;
            else if (min)         range = min;
            else if (max)         range = max;
            if (range) parts.push("(" + range + ")");

            luckMap[lv] = parts.join(" ");
          }

          const tbody = expTable.querySelector("tbody");
          if (!tbody) return;

          tbody.querySelectorAll("tr").forEach(tr => {
            const tds = tr.querySelectorAll("td");
            // 「読み込み中…」行はスキップ
            if (tds.length === 1) return;
            if (tds.length < 2) return;

            const lvText = tds[0].textContent.trim();
            if (!/^\d+$/.test(lvText)) return;

            const display = luckMap[lvText] || "";

            // 3列目（運基準）を追加 or 更新
            if (tds.length === 2) {
              const td = document.createElement("td");
              td.textContent = display;
              tr.appendChild(td);
            } else {
              tds[2].textContent = display;
            }
          });
        })
        .catch(err => {
          console.error("運基準の読込エラー:", err);
        });
    });
  </script>
</body>
</html>
